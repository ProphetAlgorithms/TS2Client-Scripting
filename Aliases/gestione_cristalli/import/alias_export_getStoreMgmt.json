{
  "class": "OtherMgmt",
  "enabled": true,
  "id": "getStoreMgmt",
  "is_prompt": false,
  "is_script": true,
  "pattern": "^(mput|mget)(?:\\s+([0-9]+))?\\s+((?:[a-zA-Z-]+))\\s*(?:\\s+([0-9]+))?$",
  "regex": true,
  "value": "let oggetto = match[3].split(\"-\").filter(e => e !== \"\");\nlet personale = \"ED\" + TSPersonaggio;\nlet borsaPrincipale = \"borsa-ombra\";\nlet sendSilent = true;\nlet howManyCmd;\nlet howManyContainer;\nlet findResult;\n\nif (typeof match[2] !== 'undefined') {\n  howManyCmd = match[2]\n} else {\n  howManyCmd = 1;\n}\n\nif (typeof match[4] !== 'undefined') {\n  howManyContainer = match[4] + \".\"\n} else {\n  howManyContainer = \"\";\n}\n\nif (typeof otherMgmtData == 'undefined' || _.isEmpty(otherMgmtData) === true) {\n      this.otherMgmtData = {};\n      otherMgmtData.sacca_alchimista = {\n                                         \"path\": [],\n                                         \"obj\": \"sacca_alchimista\",\n                                         \"default key\": \"sacca-ingredienti-alchemici-alchimisti\",\n                                         \"key\": \"sacca-ingredienti-alchemici-alchimisti\",\n                                         \"with_obj_key\": false,\n                                         \"get_full_key\": false,\n                                         \"get_one_key\": true,\n                                         \"contenuto\": {\n                                                       \"ferro\": {\n                                                                 \"priority\": false,\n                                                                 \"key\": [\"ferro\"]\n                                                                },\n                                                       \"zolfo\": {\n                                                                 \"priority\": false,\n                                                                 \"key\": [\"zolfo\"]\n                                                                },\n                                                       \"salnitro\": {\n                                                                 \"priority\": false,\n                                                                 \"key\": [\"salnitro\"]\n                                                                },\n                                                       \"mercurio\": {\n                                                                 \"priority\": false,\n                                                                 \"key\": [\"mercurio\"]\n                                                                },\n                                                       \"magnetite\": {\n                                                                 \"priority\": false,\n                                                                 \"key\": [\"magnetite\"]\n                                                                },\n                                                       \"seppia viva\": {\n                                                                 \"priority\": false,\n                                                                 \"key\": [\"seppia\",\"viva\"]\n                                                                },\n                                                       \"tentacolo polpo\": {\n                                                                 \"priority\": false,\n                                                                 \"key\": [\"tentacolo\",\"polpo\"]\n                                                                },\n                                                       \"cavalluccio marino\": {\n                                                                 \"priority\": false,\n                                                                 \"key\": [\"cavalluccio\",\"marino\"]\n                                                                },\n                                                       \"scaglia drago\": {\n                                                                 \"priority\": false,\n                                                                 \"key\": [\"scaglia\",\"drago\"]\n                                                                },\n                                                       \"gemma\": {\n                                                                 \"priority\": true,\n                                                                 \"key\": [\"gemma\"]\n                                                                }\n                                                      }\n                                       },\n      otherMgmtData.teca = {\n                             \"path\": [],\n                             \"obj\": \"teca\",\n                             \"default key\": \"teca-rune\",\n                             \"key\": \"teca-rune\",\n                             \"with_obj_key\": false,\n                             \"get_full_key\": false,\n                             \"get_one_key\": true,\n                             \"contenuto\": {\n                                           \"runa\": {\n                                                    \"priority\": true,\n                                                    \"key\": [\"runa\"]\n                                                   }\n                                          }\n                          },\n      otherMgmtData.scrigno_dorato = {\n                                      \"path\": [],\n                                      \"obj\": \"scrigno_dorato\",\n                                      \"default key\": \"scrigno-dorato\",\n                                      \"key\": \"scrigno-dorato\",\n                                      \"with_obj_key\": true,\n                                      \"get_full_key\": true,\n                                      \"get_one_key\": false,\n                                      \"contenuto\": {\n                                                    \"cristallo\": {\n                                                                  \"priority\": true,\n                                                                  \"key\": [\"cristallo\"]\n                                                                 },\n                                                    \"sangue drago goccia\": {\n                                                                  \"priority\": false,\n                                                                  \"key\": [\"sangue\",\"drago\",\"goccia\"]\n                                                                 }\n                                                   }\n                                     }\n}\n\nfunction resetData() {\n      otherMgmtData = {};\n      print(color(\"Dati del comando resettati.\",\"#bb00bb\"));\n}\n\nfunction findObj(objStrArr, containersObjList) {\n  let toSearch = [];\n  let ifStartWith = false;\n  let input_without_priority = [];\n  let put_index = \"\";\n  let get_obj = objStrArr;\n  let containerSend = \"\";\n  //let regexParam = strArr.toString().replace(/,/g,\"|\");\n  //let ifStartWithRegex = new RegExp(\"(?<=\\\\s|^)((?:\" + regexParam + \")[^\\\\s]*)(?=\\\\s|$)\",\"gm\");\n  for (const [container, containerStruct] of Object.entries(containersObjList)) {\n    for (const [content, contentList] of Object.entries(containerStruct.contenuto)) {\n       toSearch = [];\n       if (contentList.priority === false) {\n         toSearch = objStrArr;\n       } else {\n         input_without_priority = [...objStrArr];\n         toSearch = contentList.key;     \n       }\n       for (let i in contentList.key) {\n         for (let k in objStrArr) {\n           ifStartWith = contentList.key[i].toLowerCase().startsWith(objStrArr[k].toLowerCase()); \n           if (ifStartWith) {\n             if (input_without_priority.length > 1 && contentList.priority == true) {input_without_priority[k] = \"\"}\n             toSearch = toSearch.toSpliced(0,1);\n             if (toSearch.length == 0) {\n               input_without_priority = input_without_priority.filter(str => str !== \"\");\n               if (containerStruct.with_obj_key == true) {put_index = \"2.\"}\n               if (contentList.priority == true) {get_obj = input_without_priority}\n               if (containerStruct.get_one_key == true) {get_obj = [get_obj[0]]}\n               if (containerStruct.with_obj_key == true) {\n                 containerSend = containerStruct.key + \"-\" + objStrArr.join(\"-\")\n               } else {\n                 containerSend = containerStruct.key\n               }\n               return {\n                       \"result\": true,\n                       \"put_index\": put_index,\n                       \"get_obj\": get_obj.join(\"-\"),\n                       \"container\": containerSend,\n                       \"path\": containerStruct.path\n                      }\n             }\n           }\n         }\n       }\n    }\n  }\n  return {\"result\": false}\n}\n\nfunction getContainer(start, end, path) {\n  let fullPath = [start, ...path, end];\n  for (let i=1; i<fullPath.length; i++) {\n       if (i == fullPath.length - 1) {\n         send(\"~\" + \"get \" + howManyContainer + fullPath[i] + \" \" + fullPath[i - 1], sendSilent);\n       } else {\n          send(\"~\" + \"get \" + fullPath[i] + \" \" + fullPath[i - 1], sendSilent);\n       }\n  }\n}\n\nfunction storeContainer(start, end, path) {\n  let fullPath = [start, ...path, end];\n  for (let i=fullPath.length-1 ; i>0; i--) {\n    send(\"~\" + \"metti \" + fullPath[i] + \" \" + fullPath[i - 1], sendSilent);\n  }\n}\n\nif (typeof otherMgmtData == 'undefined') {\n  resetData();\n}\n\nswitch (match[1]) {\n  case \"mput\":\n      findResult = findObj(oggetto, otherMgmtData);\n      if (findResult.result) {\n        getContainer(borsaPrincipale, findResult.container, findResult.path);\n        for (let i = 0; i < howManyCmd; i++) {\n            send(\"~\" + \"metti \" + findResult.put_index + oggetto.join(\"-\") + \" \" + findResult.container, sendSilent);\n        } \n        storeContainer(borsaPrincipale, findResult.container, findResult.path);\n      }\n  break;\n  case \"mget\":\n      findResult = findObj(oggetto, otherMgmtData);\n      if (findResult.result) {\n        getContainer(borsaPrincipale, findResult.container, findResult.path);\n        for (let i = 0; i < howManyCmd; i++) {\n           send(\"~\" + \"get \" + findResult.get_obj + \" \" + findResult.container, sendSilent);\n        }\n        storeContainer(borsaPrincipale, findResult.container, findResult.path);\n      }   \n}\n\nswitch (oggetto[0]) {\n  case \"reset\":\n    resetData();\n}",
  "shortcut": ""
}
